GAMS Rev 234  WIN-VS8 23.4.3 x86/MS Windows             03/01/12 10:49:08 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


       
       
      Here is a "MAP" of the EBT (coal, fuelgas, oil, refined oil, natural gas, 
      electricity and heat, other energy)
       
       
       
                 PROD    DX       X      DRC     RC     COAL     FG     OIL     
       ROIL     NG     ELEH    OTHE
       
              ------------------------------------------------------------------
      ------------------------------
      BEJ     |       |       |       |       |       |       |       |       | 
            |       |       |       |
              ------------------------------------------------------------------
      ------------------------------
      ...
              ------------------------------------------------------------------
      ------------------------------
      XIN     |       |       |       |       |       |       |       |       | 
            |       |       |       |
              ------------------------------------------------------------------
      ------------------------------
       
                 AGR     IND     CON     TR     WRHR    OTH      FU       INV
              ------------------------------------------------------------------
      ------------------------------
      BEJ     |       |       |       |       |       |       |       |       | 
            |       |       |       |
              ------------------------------------------------------------------
      ------------------------------
      ...
              ------------------------------------------------------------------
      ------------------------------
      XIN     |       |       |       |       |       |       |       |       | 
            |       |       |       |
              ------------------------------------------------------------------
      ------------------------------
       
      We need rebalance EBT in order to:
      a) All the data is consitent with the national EBT (0401.xls)
      b) SUM(DX)=SUM(DRC)
       
      After the rebalancing work, we can estimate detailed industry energy consu
      mption of each province.
       
  34   
  38   
  39  *SAM table
  40  set     e       energy product  /
  41           coal    Coal,
  42           fg      Fuel gas,
  43           oil     Crude oil,
  44           roil    Refined oil,
  45           ng      Natural gas,
  46           eleh    Electricity & heat,
  47           othe    Other energy/;
  48  set     indi    egy-intensive sectors    /
  49           COAL,
  50           OIL,
  51           MM,
  52           NM,
  53           FBT,
  54           TXT,
  55           CLO,
  56           LOG,
  57           PAP,
  58           ROIL,
  59           CHE,
  60           NMP,
  61           MSP,
  62           MP,
  63           GSM,
  64           TME,
  65           EME,
  66           CCE,
  67           IM,
  68           AC,
  69           WAS,
  70           ELEH,
  71           FG,
  72           WT/;
  73  set     i       accounts /
  74           PROD    Production,
  75           DX      Domestic outflow,
  76           X       Export,
  77           DRC     Domestic inflow,
  78           RC      Import,
  79           COALT   Coal converted from other energy product,
  80           FGT     Fuel gas converted from other energy product,
  81           OILT   Crude oil converted from other energy product,
  82           ROILT   Refined oil converted from other energy product,
  83           NGT     Natural gas converted from other energy productconverted 
      from other energy product,
  84           ELEHT   Electricity & heat converted from other energy product,
  85           OTHET   Other energy converted from other energy product,
  86           AGR     Agriculture,
  87           IND     Industry,
  88           CON     Construction,
  89           TR      Transportation,
  90           WRHR    Wholesale & retail & hotel & restraurant,
  91           OTH     Other service industry,
  92           FU      Final use,
  93           INV     Inventory change/;
  94   
  95  set      r China provinces       /BEJ,TAJ,HEB,SHX,NMG,LIA,JIL,HLJ,SHH,JSU,
      ZHJ,ANH,FUJ,JXI,SHD,HEN,HUB,HUN,GUD,GXI,HAI,CHQ,SIC,GZH,YUN,SHA,GAN,NXA,QI
      H,XIN/;
  96  parameter coal(r,i)           coal ebt
  97  parameter fg(r,i)           fg ebt
  98  parameter oil(r,i)           oil ebt
  99  parameter roil(r,i)           roil ebt
 100  parameter ng(r,i)           ng ebt
 101  parameter eleh(r,i)           eleh ebt
 102  parameter othe(r,i)           othe ebt
 103  parameter coal_bench(i,*)
 104  parameter fg_bench(i,*)
 105  parameter oil_bench(i,*)
 106  parameter roil_bench(i,*)
 107  parameter ng_bench(i,*)
 108  parameter eleh_bench(i,*)
 109  parameter othe_bench(i,*)
 110  parameter ind(*,indi,e)           egy cons of egy by intensive ind
 111  parameter indprov(*,r,e)       egy cons of egy product by province
 112  parameter columnsum(i)
 113  parameter benchvalue(i)
 114   
GDXIN   C:\Users\DaZHANG\data\ChinaBalancedSAM\data\gdx\egygdx\COAL.gdx
--- LOAD  coal = 1:coal
 118  display COAL
GDXIN   C:\Users\DaZHANG\data\ChinaBalancedSAM\data\gdx\egygdx\COAL_bench.gdx
--- LOAD  coal_bench = 1:coal_bench
 121  display COAL_bench
 122   
 123  loop(i,
 124  columnsum(i)=sum(r, COAL(r,i)););
 125  display columnsum
 126   
 127  loop(i$ ((ord(i)<>2) and (ord(i)<>4)),
 128  benchvalue(i)= COAL_bench(i,"value");
 129  );
 130  display benchvalue
 131   
 132  variables       x(r,i)  adjusted value
 133  variable        j       obj function
 134   
 135  Equations criterion_coal criterion definition
 136           criterion_fg
 137           criterion_oil
 138            criterion_roil
 139            criterion_ng
 140            criterion_eleh
 141            criterion_othe
 142             bench   benchmark egy
 143             balance_coal  input output balance
 144             balance_fg
 145             balance_oil
 146             balance_roil
 147             balance_ng
 148             balance_eleh
 149             balance_othe
 150             trade   domestic trade balance
 151             sign    negative only for t and inv;
 152   
 153   
 154  criterion_coal$(sameas('COAL','COAL'))..
 155  j=e=sum((r,i)$(COAL(r,i)<>0),sqr(x(r,i)/COAL(r,i)-1))+10000*sum(i$((ord(i)
      <>2) and (ord(i)<>4)and (abs(benchvalue(i))>0.01)),sqr(sum(r,x(r,i))/bench
      value(i) - 1));
 156  *j=e=sum((r,i)$%egyprod%(r,i),x(r,i)*(log(x(r,i)/%egyprod%(r,i))-1));
 157  *j=e=sum((r,i),sqr(x(r,i)-%egyprod%(r,i))/100000);
 158   
 159  criterion_fg$(sameas('COAL','FG'))..
 160  j=e=sum((r,i)$(COAL(r,i)<>0),sqr(x(r,i)/COAL(r,i)-1))+6*sum(i$((ord(i)<>2)
       and (ord(i)<>4)and (abs(benchvalue(i))>0.01)),sqr(sum(r,x(r,i))/benchvalu
      e(i) - 1));
 161   
 162  criterion_oil$(sameas('COAL','OIL'))..
 163  j=e=sum((r,i)$(COAL(r,i)<>0),sqr(x(r,i)/COAL(r,i)-1))+100*sum(i$((ord(i)<>
      2) and (ord(i)<>4)and (abs(benchvalue(i))>0.01)),sqr(sum(r,x(r,i))/benchva
      lue(i) - 1));
 164   
 165  criterion_roil$(sameas('COAL','ROIL'))..
 166  j=e=sum((r,i)$(COAL(r,i)<>0),sqr(x(r,i)/COAL(r,i)-1))+6*sum(i$((ord(i)<>2)
       and (ord(i)<>4)and (abs(benchvalue(i))>0.01)),sqr(sum(r,x(r,i))/benchvalu
      e(i) - 1));
 167   
 168  criterion_ng$(sameas('COAL','NG'))..
 169  j=e=sum((r,i)$(COAL(r,i)<>0),sqr(x(r,i)/COAL(r,i)-1))+6*sum(i$((ord(i)<>2)
       and (ord(i)<>4)and (abs(benchvalue(i))>0.01)),sqr(sum(r,x(r,i))/benchvalu
      e(i) - 1));
 170   
 171  criterion_eleh$(sameas('COAL','ELEH'))..
 172  j=e=sum((r,i)$(COAL(r,i)<>0),sqr(x(r,i)/COAL(r,i)-1))+6*sum(i$((ord(i)<>2)
       and (ord(i)<>4)and (abs(benchvalue(i))>0.01)),sqr(sum(r,x(r,i))/benchvalu
      e(i) - 1));
 173   
 174  criterion_othe$(sameas('COAL','OTHE'))..
 175  j=e=sum((r,i)$(COAL(r,i)<>0),sqr(x(r,i)/COAL(r,i)-1))+6*sum(i$((ord(i)<>2)
       and (ord(i)<>4)and (abs(benchvalue(i))>0.01)),sqr(sum(r,x(r,i))/benchvalu
      e(i) - 1));
 176   
 177  *No bench for dx and drc
 178  *bench(i)$((ord(i)<>2) and (ord(i)<>4))..
 179  *sum(r,x(r,i)) =e= benchvalue(i);
 180  *coal
 181  balance_coal(r)$(sameas('COAL','COAL'))..
 182  2*(x(r,"PROD")+x(r,"RC")+x(r,"DRC")+x(r,"COALT"))=e=sum(i,x(r,i));
 183   
 184  *fg
 185  balance_fg(r)$(sameas('COAL','FG'))..
 186  2*(x(r,"PROD")+x(r,"RC")+x(r,"DRC")+x(r,"FGT"))=e=sum(i,x(r,i));
 187  *oil
 188  balance_oil(r)$(sameas('COAL','OIL'))..
 189  2*(x(r,"PROD")+x(r,"RC")+x(r,"DRC")+x(r,"OILT"))=e=sum(i,x(r,i));
 190  *roil
 191  balance_roil(r)$(sameas('COAL','ROIL'))..
 192  2*(x(r,"PROD")+x(r,"RC")+x(r,"DRC")+x(r,"ROILT"))=e=sum(i,x(r,i));
 193  *ng
 194  balance_ng(r)$(sameas('COAL','NG'))..
 195  2*(x(r,"PROD")+x(r,"RC")+x(r,"DRC")+x(r,"NGT"))=e=sum(i,x(r,i));
 196  *eleh
 197  balance_eleh(r)$(sameas('COAL','ELEH'))..
 198  2*(x(r,"PROD")+x(r,"RC")+x(r,"DRC")+x(r,"ELEHT"))=e=sum(i,x(r,i));
 199  *othe
 200  balance_othe(r)$(sameas('COAL','OTHE'))..
 201  2*(x(r,"PROD")+x(r,"RC")+x(r,"DRC")+x(r,"OTHET"))=e=sum(i,x(r,i));
 202   
 203  trade..
 204  sum(r,x(r,"DX"))=e=sum(r,x(r,"DRC"));
 205   
 206   
 207  sign(r,i)$((ord(i)<>6) and (ord(i)<>7) and (ord(i)<>8) and (ord(i)<>9) and
       (ord(i)<>10) and (ord(i)<>11) and (ord(i)<>12))..
 208  x(r,i)=g=0;
 209   
 210  Model gua /all/;
 211  x.l(r,i)= COAL(r,i);
 212  x.l(r,i)$((ord(i)<>2) and (ord(i)<>4) and (abs(columnsum(i))>0.01))= COAL(
      r,i)/columnsum(i)*benchvalue(i);
 213  Display x.l;
 214  x.fx(r,i)$(abs(x.l(r,i))<0.0001) = 0;
 215  *x.up(r,i)=max(%egyprod%(r,i)*5,%egyprod%(r,i)/5);
 216  *x.lo(r,i)=min(%egyprod%(r,i)*5,%egyprod%(r,i)/5);
 217   
 218  gua.iterlim=1000;
 219  Solve gua minimizing j using nlp;
****                                  $71,256
**** LINE    223 INPUT       C:\Users\DaZHANG\data\ChinaBalancedSAM\egydatabalan
                             ce.gms
**** The following NLP errors were detected in model gua:
****  71 bench is an undefined equation
 220   
 221   
 222   
 223   
GAMS Rev 234  WIN-VS8 23.4.3 x86/MS Windows             03/01/12 10:49:08 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Error Messages


 71  The symbol shown has been declared as an equation, but no
        Symbolic equation (..) was found. hint - look for commas in the
        Documentation text for the equations. use quotes around the
        Text or eliminate the commas.
256  Error(s) in analyzing solve statement. More detail appears
     Below the solve statement above

**** 2 ERROR(S)   0 WARNING(S)
GAMS Rev 234  WIN-VS8 23.4.3 x86/MS Windows             03/01/12 10:49:08 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\DaZHANG\data\ChinaBalancedSAM
                                          \egydatabalance.gms
     2      115 IF EXIST       1     115  C:\Users\DaZHANG\data\ChinaBalancedSAM
                                          \data\gdx\egygdx\COAL.gdx
     3      116 GDXIN          1     120  C:\Users\DaZHANG\data\ChinaBalancedSAM
                                          \data\gdx\egygdx\COAL.gdx
     4      119 GDXIN          1     123  C:\Users\DaZHANG\data\ChinaBalancedSAM
                                          \data\gdx\egygdx\COAL_bench.gdx


COMPILATION TIME     =        0.062 SECONDS      3 Mb  WIN234-234 May 21, 2010


USER: Institute of Nuclear and New Energy Technology G101217:1031AV-WIN
      TsingHua Univerrsity                                       DC8455
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\DaZHANG\data\ChinaBalancedSAM\egydatabalance.gms
Output     C:\Users\DaZHANG\data\ChinaBalancedSAM\egydatabalance.lst

**** USER ERROR(S) ENCOUNTERED
