GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/12/12 15:29:42 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


       
              Production activities   A (30)
              Commodities             C (30)
              Primary Factors         F (2)
              Households              H (1)
              Central Government      G1(1)
              Provincial Government   G2(1)
              Types of taxes          T (4)
              Rest of country         DX(1)
              Rest of world           X (1)
              Investment-savings      I (2)
       
      Here is a "MAP" of the SAM with the names of the submatrices which
      contain data.  All cells with no labels are empty:
       
       
       
                 A       C        F       H      G1      G2       T       DX    
        X      I1      I2
              ------------------------------------------------------------------
      ----------------------
      A       |       |   ac  |       |       |       |       |   sa  |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      C       |   ca  |       |       |   ch  |       |  g2d  |       |   der | 
        er  |  cs1  |  cs2  |
              ------------------------------------------------------------------
      ----------------------
      F       |   fa  |       |       |       |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      H       |       |       |   hf  |       |       |  hg2  |       |   dhr | 
        hr  |       |       |
              ------------------------------------------------------------------
      ----------------------
      G1      |       |       |       |       |       |  g1g2 |       |       | 
            |  cg1s |       |
              ------------------------------------------------------------------
      ----------------------
      G2      |       |       |       |       | g2g1  |       |   tr  |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      T       |   ta  |       |       |       |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      DX      |       |  drc  |       |  drh  |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      X       |       |   rc  |       |   rh  |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      I1      |       |       |   dp  |  psv1 | g1sv  |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      I2      |       |   ic  |       |  psv2 |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
       
  48   
  49  *SAM table
  50  set     i   SAM rows and colums indices   /
  51          1*30    Industries,
  52          31*60   Commodities,
  53          61      Labor,
  54          62      Capital,
  55          63      Household,
  56          64      Central Government,
  57          65      Local Government,
  58          66      Production tax,
  59          67      Commodity tax,
  60          68      Factor tax,
  61          69      Income tax,
  62          70      Domestic trade,
  63          71      Foreign trade,
  64          72      Investment,
  65          73      Inventory/;
  66  alias (i,j,ii);
  67  *Energy balance table
  68  set ebti /
  69           1       DX,
  70           2       X,
  71           3       DRC,
  72           4       RC,
  73           5       AGR,
  74           6       COAL,
  75           7       OIL,
  76           8       MM,
  77           9       NM,
  78           10      FBT,
  79           11      TXT,
  80           12      CLO,
  81           13      LOG,
  82           14      PAP,
  83           15      ROIL,
  84           16      CHE,
  85           17      NMP,
  86           18      MSP,
  87           19      MP,
  88           20      GSM,
  89           21      TME,
  90           22      EME,
  91           23      CCE,
  92           24      IM,
  93           25      AC,
  94           26      WAS,
  95           27      ELEH,
  96           28      FG,
  97           29      WT,
  98           30      CON,
  99           31      TR,
 100           32      WRHR,
 101           33      OTH,
 102           34      NG,
 103           35      FU,
 104           36      INV,
 105           37      PROD
 106  /;
 107  set      e       energy product  /
 108           coal    Coal,
 109           fg      Fuel gas,
 110           oil     Crude oil,
 111           roil    Refined oil,
 112           ng      Natural gas,
 113           eleh    Electricity & heat,
 114           othe    Other energy/;
 115  set      r China provinces       /BEJ,TAJ,HEB,SHX,NMG,LIA,JIL,HLJ,SHH,JSU,
      ZHJ,ANH,FUJ,JXI,SHD,HEN,HUB,HUN,GUD,GXI,HAI,CHQ,SIC,GZH,YUN,SHA,GAN,NXA,QI
      H,XIN/;
 116  set      prange/
 117           LB,
 118           UB/;
 119  parameter sam3(r,i,j)           SAM v3.0 ready for rebalancing
 120  parameter ebt(e,r,ebti)         EBT
 121  parameter ebt2(i,r,ebti)        EBT for OPT
 122  parameter pricerange(i,prange)  Price range of energy products
 123  parameter oilngratio(r)         Oil and gas ratio of (PROD+DRC+RC-X-DX)
 124  parameter poilng
GDXIN   C:\Users\dzhang\data\ChinaBalancedSAM\/data/gdx/sam3.gdx
--- LOAD  sam3 = 9:sam3
--- LOAD  ebt2 = 11:ebt2
--- LOAD  pricerange = 12:pricerange
 129   
 130  *$ontext
 131  positive variables finalsam (r,i,j)
 132  positive variables rowsum(r,i)
 133  positive variables columnsum(r,i)
 134  positive variables domesticinsum(i)
 135  positive variables domesticoutsum(i)
 136  positive variables p(i,r,j)
 137  variable jj
 138   
 139  Equations
 140          rsum
 141          csum
 142          sumbalance
 143          drcsum
 144          dxsum
 145   
 146         price_dx
 147         price_x
 148         price_drc
 149         price_rc
 150         price_inv
 151         price_fu
 152         price_prod
 153         price_sectors
 154   
 155         pricelb
 156   
 157         priceub
 158         obj
 159  ;
 160   
 161   
 162  *rsum(r,i)..
 163  rsum(r,i)$(sameas(r,'BEJ'))..
 164  sum(j,finalsam(r,i,j))=e=rowsum(r,i);
 165   
 166  *csum(r,i)..
 167  csum(r,i)$(sameas(r,'BEJ'))..
 168  sum(j,finalsam(r,j,i))=e=columnsum(r,i);
 169   
 170  *sumbalance(r,i)..
 171  sumbalance(r,i)$(sameas(r,'BEJ'))..
 172  rowsum(r,i)=e=columnsum(r,i);
 173   
 174  drcsum(i)$((ord(i)>=31) and (ord(i)<=60))..
 175  domesticinsum(i)=e=sum(r,finalsam(r,"70",i));
 176   
 177  dxsum(i)$((ord(i)>=31) and (ord(i)<=60))..
 178  domesticoutsum(i)=e=sum(r,finalsam(r,i,"70"));
 179   
 180   
 181  *dx
 182  price_dx(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) o
      r (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30))..
 183  p(i,r,"1")*ebt2(i,r,"1")=e=finalsam(r,j,"70");
 184  *x
 185  price_x(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or
       (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30))..
 186  p(i,r,"2")*ebt2(i,r,"2")=e=finalsam(r,j,"71");
 187  *drc
 188  price_drc(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) 
      or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30))..
 189  p(i,r,"3")*ebt2(i,r,"3")=e=finalsam(r,"70",j);
 190  *rc
 191  price_rc(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) o
      r (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30))..
 192  p(i,r,"4")*ebt2(i,r,"4")=e=finalsam(r,"71",j);
 193  *inv
 194  price_inv(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) 
      or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30))..
 195  p(i,r,"35")*ebt2(i,r,"35")=e=finalsam(r,j,"63")+finalsam(r,j,"65");
 196  *fu
 197  price_fu(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) o
      r (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30))..
 198  p(i,r,"36")*ebt2(i,r,"36")=e=finalsam(r,j,"73");
 199  *prod
 200  price_prod(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23)
       or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30))..
 201  p(i,r,"37")*ebt2(i,r,"37")=e=finalsam(r,i,j);
 202   
 203  *$ontext
 204  *sectors
 205  price_sectors(i,r,j,ebti,ii)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or 
      (ord(i)=23) or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and ((or
      d(ebti)>=5) and (ord(ebti)<=34)) and (ord(ii)=ord(ebti)-4))..
 206  (p(i,r,ii)*ebt2(i,r,ebti)-finalsam(r,j,ii))*finalsam(r,j,ii)=e=0;
 207  *$offtext
 208   
 209  *lb
 210  pricelb(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or
       (ord(i)=24) or (ord(i)=30)) and ((ord(j)>=1) and (ord(j)<=37)))..
 211  (p(i,r,j)-pricerange(i,"lb"))=g=0;
 212  *ub
 213  priceub(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or
       (ord(i)=24) or (ord(i)=30)) and ((ord(j)>=1) and (ord(j)<=37)))..
 214  (p(i,r,j)-pricerange(i,"ub"))=l=0;
 215   
 216  obj..
 217  jj=e=sum(r$(sameas(r,'BEJ')),sum(i,sum(j,sqr(finalsam(r,i,j)-sam3(r,i,j)))
      ));
 218   
 219  Model gua /all/;
 220  loop(r,
 221  loop(i,
 222  loop(j,
 223  finalsam.l(r,i,j)=sam3(r,i,j);
 224  );););
 225  loop(r,
 226  loop(i,
 227  loop(j,
 228  if (sam3(r,i,j)=0,
 229  finalsam.fx(r,i,j)=0;
 230  );
 231  );
 232  );
 233  );
 234  gua.iterlim=100000;
 235  Solve gua minimizing jj using nlp;
 236  display finalsam.l;
 237   
 238  *chksam
 239  set     negval4(i,j)     Flag for negative elements;
 240  set     empty4(i,*)      Flag for empty rows and columns;
 241  parameter       chksam4(i,*)       Consistency check of social accounts;
 242  parameter totoutput2;
 243  totoutput2=0;
 244  loop(r$(sameas('BEJ',r)),
 245  loop(i$((ord(i)>=31) and (ord(i)<=60)),
 246  totoutput2=totoutput2+sum(j,finalsam.l(r,i,j));
 247  );
 248  );
 249  loop(r$(sameas('BEJ',r)),
 250  negval4(i,j) = yes$(sam3(r,i,j) < 0);
 251  empty4(i,"row") = 1$(sum(j, finalsam.l(r,i,j)) = 0);
 252  empty4(j,"col") = 1$(sum(i, finalsam.l(r,i,j)) = 0);
 253  chksam4(i,"before") = sum(j, finalsam.l(r,i,j)-finalsam.l(r,j,i));
 254  chksam4(i,"scale") = sum(j, finalsam.l(r,j,i));
 255  chksam4(i,"%dev")$sum(j, finalsam.l(r,i,j)) = 100 * sum(j, finalsam.l(r,i,
      j)-finalsam.l(r,j,i)) / sum(j, finalsam.l(r,i,j));
 256  );
 257  parameter sam4(i,j);
 258  loop(r$(sameas('BEJ',r)),
 259  loop(i,
 260  loop(j,
 261  sam4(i,j)= finalsam.l(r,i,j);
 262  );
 263  );
 264  );
 265   
 266  *Energy related data
 267  parameter egyvalue(i,r,ebti);
 268  loop(r,
 269  loop(i$((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or (ord(i)=
      24) or (ord(i)=30)),
 270  loop(j$(ord(j)=ord(i)+30),
 271  egyvalue(i,r,"1")=sam4(r,j,"70");
****                          $171   $148
 272  egyvalue(i,r,"2")=sam4(r,j,"71");
****                          $171   $148
 273  egyvalue(i,r,"3")=sam4(r,"70",j);
****                          $171   $148
 274  egyvalue(i,r,"4")=sam4(r,"71",j);
****                          $171   $148
 275  loop(ebti$((ord(ebti)>=5) and (ord(ebti)<=34)),
 276  loop(ii$(ord(ii)=ord(ebti)-4),
 277  egyvalue(i,r,ebti)=sam4(r,j,ii);
****                           $171 $148
 278  );
 279  );
 280  egyvalue(i,r,"35")=sam4(r,j,"63")+sam4(r,j,"65");
****                           $171   $148    $171   $148
 281  egyvalue(i,r,"36")=sam4(r,j,"73");
****                           $171   $148
 282  egyvalue(i,r,"37")=sam4(r,i,j);
****                           $171$148
 283  );););
 284  display egyvalue;
 285   
 286   
GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/12/12 15:29:42 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Error Messages


148  Dimension different - The symbol is referenced with more/less
        indices as declared
171  Domain violation for set

**** 18 ERROR(S)   0 WARNING(S)
GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/12/12 15:29:42 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          finalbalancing.gms
     2      125 GDXIN          1     125  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          /data/gdx/sam3.gdx


COMPILATION TIME     =        0.078 SECONDS      4 Mb  WEX232-232 Aug 11, 2009


USER: Institute of Nuclear and New Energy Technology G101217:1031AV-WIN
      TsingHua Univerrsity                                       DC8455
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\dzhang\data\ChinaBalancedSAM\finalbalancing.gms
Output     C:\Users\dzhang\data\ChinaBalancedSAM\finalbalancing.lst

**** USER ERROR(S) ENCOUNTERED
