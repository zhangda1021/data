GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/15/12 14:56:09 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


       
              Production activities   A (30)
              Commodities             C (30)
              Primary Factors         F (2)
              Households              H (1)
              Central Government      G1(1)
              Provincial Government   G2(1)
              Types of taxes          T (4)
              Rest of country         DX(1)
              Rest of world           X (1)
              Investment-savings      I (2)
       
      Here is a "MAP" of the SAM with the names of the submatrices which
      contain data.  All cells with no labels are empty:
       
       
       
                 A       C        F       H      G1      G2       T       DX    
        X      I1      I2
              ------------------------------------------------------------------
      ----------------------
      A       |       |   ac  |       |       |       |       |   sa  |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      C       |   ca  |       |       |   ch  |       |  g2d  |       |   der | 
        er  |  cs1  |  cs2  |
              ------------------------------------------------------------------
      ----------------------
      F       |   fa  |       |       |       |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      H       |       |       |   hf  |       |       |  hg2  |       |   dhr | 
        hr  |       |       |
              ------------------------------------------------------------------
      ----------------------
      G1      |       |       |       |       |       |  g1g2 |       |       | 
            |  cg1s |       |
              ------------------------------------------------------------------
      ----------------------
      G2      |       |       |       |       | g2g1  |       |   tr  |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      T       |   ta  |       |       |       |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      DX      |       |  drc  |       |  drh  |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      X       |       |   rc  |       |   rh  |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      I1      |       |       |   dp  |  psv1 | g1sv  |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      I2      |       |   ic  |       |  psv2 |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
       
  48   
  49  *SAM table
  50  set     i   SAM rows and colums indices   /
  51          1*30    Industries,
  52          31*60   Commodities,
  53          61      Labor,
  54          62      Capital,
  55          63      Household,
  56          64      Central Government,
  57          65      Local Government,
  58          66      Production tax,
  59          67      Commodity tax,
  60          68      Factor tax,
  61          69      Income tax,
  62          70      Domestic trade,
  63          71      Foreign trade,
  64          72      Investment,
  65          73      Inventory/;
  66  alias (i,j,ii);
  67  *Energy balance table
  68  set ebti /
  69           1       DX,
  70           2       X,
  71           3       DRC,
  72           4       RC,
  73           5       AGR,
  74           6       COAL,
  75           7       OIL,
  76           8       MM,
  77           9       NM,
  78           10      FBT,
  79           11      TXT,
  80           12      CLO,
  81           13      LOG,
  82           14      PAP,
  83           15      ROIL,
  84           16      CHE,
  85           17      NMP,
  86           18      MSP,
  87           19      MP,
  88           20      GSM,
  89           21      TME,
  90           22      EME,
  91           23      CCE,
  92           24      IM,
  93           25      AC,
  94           26      WAS,
  95           27      ELEH,
  96           28      FG,
  97           29      WT,
  98           30      CON,
  99           31      TR,
 100           32      WRHR,
 101           33      OTH,
 102           34      NG,
 103           35      FU,
 104           36      INV,
 105           37      PROD
 106  /;
 107  set      e       energy product  /
 108           coal    Coal,
 109           fg      Fuel gas,
 110           oil     Crude oil,
 111           roil    Refined oil,
 112           ng      Natural gas,
 113           eleh    Electricity & heat,
 114           othe    Other energy/;
 115  set      r China provinces       /BEJ,TAJ,HEB,SHX,NMG,LIA,JIL,HLJ,SHH,JSU,
      ZHJ,ANH,FUJ,JXI,SHD,HEN,HUB,HUN,GUD,GXI,HAI,CHQ,SIC,GZH,YUN,SHA,GAN,NXA,QI
      H,XIN/;
 116  set      prange/
 117           LB,
 118           UB/;
 119  parameter sam3(r,i,j)           SAM v3.0 ready for rebalancing
 120  parameter ebt(e,r,ebti)         EBT
 121  parameter ebt2(i,r,ebti)        EBT for OPT
 122  parameter pricerange(i,prange)  Price range of energy products
 123  parameter oilngratio(r)         Oil and gas ratio of (PROD+DRC+RC-X-DX)
 124  parameter poilng
GDXIN   C:\Users\dzhang\data\ChinaBalancedSAM\/data/gdx/sam3.gdx
--- LOAD  sam3 = 9:sam3
--- LOAD  ebt2 = 30:ebt2
--- LOAD  pricerange = 11:pricerange
 129   
 130   
 131   
 132   
 133  *$ontext
 134  positive variables finalsam (r,i,j)
 135  positive variables rowsum(r,i)
 136  positive variables columnsum(r,i)
 137  positive variables domesticinsum(i)
 138  positive variables domesticoutsum(i)
 139  positive variables p(i,r,ebti)
 140  variable jj
 141   
 142  Equations
 143          rsum
 144          csum
 145          sumbalance
 146   
 147         price_dx
 148         price_x
 149         price_drc
 150         price_rc
 151         price_inv
 152         price_fu
 153         price_prod
 154         price_sectors
 155   
 156         pricelb
 157   
 158         priceub
 159         obj
 160  ;
 161   
 162   
 163  *rsum(r,i)..
 164  rsum(r,i)$(sameas(r,'BEJ'))..
 165  sum(j,finalsam(r,i,j))=e=rowsum(r,i);
 166   
 167  *csum(r,i)..
 168  csum(r,i)$(sameas(r,'BEJ'))..
 169  sum(j,finalsam(r,j,i))=e=columnsum(r,i);
 170   
 171  *sumbalance(r,i)..
 172  sumbalance(r,i)$(sameas(r,'BEJ'))..
 173  rowsum(r,i)=e=columnsum(r,i);
 174   
 175  *dx
 176  price_dx(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) o
      r (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and sameas(r,'BEJ')).
      .
 177  (p(i,r,"1")*ebt2(i,r,"1")-finalsam(r,j,"70"))*finalsam(r,j,"70")=e=0;
 178  *x
 179  price_x(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or
       (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and sameas(r,'BEJ'))..
 180  (p(i,r,"2")*ebt2(i,r,"2")-finalsam(r,j,"71"))*finalsam(r,j,"71")=e=0;
 181  *drc
 182  price_drc(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) 
      or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and sameas(r,'BEJ'))
      ..
 183  (p(i,r,"3")*ebt2(i,r,"3")-finalsam(r,"70",j))*finalsam(r,"70",j)=e=0;
 184  *rc
 185  price_rc(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) o
      r (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and sameas(r,'BEJ')).
      .
 186  (p(i,r,"4")*ebt2(i,r,"4")-finalsam(r,"71",j))*finalsam(r,"71",j)=e=0;
 187  *fu
 188  price_fu(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) o
      r (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and sameas(r,'BEJ')).
      .
 189  (p(i,r,"35")*ebt2(i,r,"35")-(finalsam(r,j,"63")+finalsam(r,j,"65")))*(fina
      lsam(r,j,"63")+finalsam(r,j,"65"))=e=0;
 190  *inv
 191  price_inv(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) 
      or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and sameas(r,'BEJ'))
      ..
 192  (p(i,r,"36")*ebt2(i,r,"36")-finalsam(r,j,"73"))*finalsam(r,j,"73")=e=0;
 193  *prod
 194  price_prod(i,r,j)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23)
       or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and sameas(r,'BEJ')
      )..
 195  (p(i,r,"37")*ebt2(i,r,"37")-finalsam(r,i,j))*finalsam(r,i,j)=e=0;
 196   
 197  *$ontext
 198  *sectors
 199  price_sectors(i,r,j,ebti,ii)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or 
      (ord(i)=23) or (ord(i)=24) or (ord(i)=30)) and (ord(j)=ord(i)+30) and ((or
      d(ebti)>=5) and (ord(ebti)<=34)) and (ord(ii)=ord(ebti)-4) and sameas(r,'B
      EJ'))..
 200  (p(i,r,ebti)*ebt2(i,r,ebti)-finalsam(r,j,ii))*finalsam(r,j,ii)=e=0;
 201  *$offtext
 202   
 203  *lb
 204  pricelb(i,r,ebti)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23)
       or (ord(i)=24) or (ord(i)=30)) and ((ord(ebti)>=1) and (ord(ebti)<=37)) a
      nd sameas(r,'BEJ'))..
 205  (p(i,r,ebti)-pricerange(i,"lb")/100000)=g=0;
 206  *ub
 207  priceub(i,r,ebti)$(((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23)
       or (ord(i)=24) or (ord(i)=30)) and ((ord(ebti)>=1) and (ord(ebti)<=37)) a
      nd sameas(r,'BEJ'))..
 208  (p(i,r,ebti)-pricerange(i,"ub")/100000)=l=0;
 209   
 210  obj..
 211  jj=e=sum(r$(sameas(r,'BEJ')),sum(i,sum(j,sqr(finalsam(r,i,j)-sam3(r,i,j)))
      ));
 212   
 213  Model gua /all/;
 214  loop(r$(sameas(r,'BEJ')),
 215  loop(i,
 216  loop(j,
 217  finalsam.l(r,i,j)=sam3(r,i,j);
 218  );););
 219  loop(i,
 220  loop(r$(sameas(r,'BEJ')),
 221  loop(ebti,
 222  if(sameas(i,"2"),
 223  p.l("2",r,ebti)=500/100000;
 224  );
 225  if(sameas(i,"3"),
 226  p.l("3",r,ebti)=3000/100000;
 227  );
 228  if(sameas(i,"11"),
 229  p.l("11",r,ebti)=3000/100000;
 230  );
 231  if(sameas(i,"23"),
 232  p.l("23",r,ebti)=1000/100000;
 233  );
 234  if(sameas(i,"24"),
 235  p.l("24",r,ebti)=5000/100000;
 236  );
 237  if(sameas(i,"30"),
 238  p.l("30",r,ebti)=1000/100000;
 239  );
 240  );););
 241  *If quantity is not zero, value is not zero
 242  loop(r$(sameas(r,'BEJ')),
 243  loop(i((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or (ord(i)=2
****         $145   $10,8,409
      4) or (ord(i)=30)),
 244  loop(j$(ord(j)=ord(i)+30),
****                     $154
 245  if(ebt2(i,r,"1")>0,
****           $149,149
 246  finalsam.l(r,j,"70")=p.l(i,r,"1")*ebt2(i,r,"1");
****                            $149          $149
 247  );
 248  if(ebt2(i,r,"2")>0,
****           $149,149
 249  finalsam.l(r,j,"71")=p.l(i,r,"2")*ebt2(i,r,"2");
****                            $149          $149
 250  );
 251  if(ebt2(i,r,"3")>0,
****           $149,149
 252  finalsam.l(r,"70",j)=p.l(i,r,"3")*ebt2(i,r,"3");
****                            $149          $149
 253  );
 254  if(ebt2(i,r,"4")>0,
****           $149,149
 255  finalsam.l(r,"71",j)=p.l(i,r,"4")*ebt2(i,r,"4");
****                            $149          $149
 256  );
 257  if(ebt2(i,r,"35")>0,
****           $149,149
 258  finalsam.l(r,j,"63")=p.l(i,r,"35")*ebt2(i,r,"35")/2;
****                            $149           $149
 259  finalsam.l(r,j,"65")=p.l(i,r,"35")*ebt2(i,r,"35")/2;
****                            $149           $149
 260  );
 261  if(ebt2(i,r,"36")>0,
****           $149,149
 262  finalsam.l(r,j,"73")=p.l(i,r,"36")*ebt2(i,r,"36");
****                            $149           $149
 263  );
 264  if(ebt2(i,r,"37")>0,
****           $149,149
 265  finalsam.l(r,i,j)=p.l(i,r,"37")*ebt2(i,r,"37");
 266  );
 267   
 268  loop(ebti$((ord(ebti)>=5) and (ord(ebti)<=34)),
 269  loop(ii$(ord(ii)=ord(ebti)-4),
 270  if(ebt2(i,r,ebti)>0,
****           $149,149
 271  finalsam.l(r,j,ii)=p.l(i,r,ebti)*ebt2(i,r,ebti);
****                          $149           $149
 272  );
 273  );
 274  );
 275  );););
****    $408,408
 276  *Fix sparcity
 277  loop(r$(sameas(r,'BEJ')),
 278  loop(i,
 279  loop(j,
 280  if (finalsam.l(r,i,j)=0,
 281  finalsam.fx(r,i,j)=0;
 282  );
 283  );
 284  );
 285  );
 286   
 287  gua.iterlim=100000;
 288  Solve gua minimizing jj using nlp;
****                                   $257
 289  display finalsam.l;
 290   
 291  *chksam
 292  set     negval4(i,j)     Flag for negative elements;
 293  set     empty4(i,*)      Flag for empty rows and columns;
 294  parameter       chksam4(i,*)       Consistency check of social accounts;
 295  parameter totoutput2;
 296  totoutput2=0;
 297  loop(r$(sameas('BEJ',r)),
 298  loop(i$((ord(i)>=31) and (ord(i)<=60)),
 299  totoutput2=totoutput2+sum(j,finalsam.l(r,i,j));
 300  );
 301  );
 302  loop(r$(sameas('BEJ',r)),
 303  negval4(i,j) = yes$(sam3(r,i,j) < 0);
 304  empty4(i,"row") = 1$(sum(j, finalsam.l(r,i,j)) = 0);
 305  empty4(j,"col") = 1$(sum(i, finalsam.l(r,i,j)) = 0);
 306  chksam4(i,"before") = sum(j, finalsam.l(r,i,j)-finalsam.l(r,j,i));
 307  chksam4(i,"scale") = sum(j, finalsam.l(r,j,i));
 308  chksam4(i,"%dev")$sum(j, finalsam.l(r,i,j)) = 100 * sum(j, finalsam.l(r,i,
      j)-finalsam.l(r,j,i)) / sum(j, finalsam.l(r,i,j));
 309  );
 310  parameter sam4(i,j);
 311  loop(r$(sameas('BEJ',r)),
 312  loop(i,
 313  loop(j,
 314  sam4(i,j)= finalsam.l(r,i,j);
 315  );
 316  );
 317  );
 318   
 319  *Energy related data
 320  parameter egyvalue2(i,r,ebti);
 321  loop(r,
 322  loop(i$((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or (ord(i)=
      24) or (ord(i)=30)),
 323  loop(j$(ord(j)=ord(i)+30),
 324  egyvalue2(i,r,"1")=sam4(j,"70");
 325  egyvalue2(i,r,"2")=sam4(j,"71");
 326  egyvalue2(i,r,"3")=sam4("70",j);
 327  egyvalue2(i,r,"4")=sam4("71",j);
 328  loop(ebti$((ord(ebti)>=5) and (ord(ebti)<=34)),
 329  loop(ii$(ord(ii)=ord(ebti)-4),
 330  egyvalue2(i,r,ebti)=sam4(j,ii);
 331  );
 332  );
 333  egyvalue2(i,r,"35")=sam4(j,"63")+sam4(j,"65");
 334  egyvalue2(i,r,"36")=sam4(j,"73");
 335  egyvalue2(i,r,"37")=sam4(i,j);
 336  );););
 337  display egyvalue2;
 338   
 339   
GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/15/12 14:56:09 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Error Messages


  8  ')' expected
 10  ',' expected
145  Set identifier or quoted element expected
149  Uncontrolled set entered as constant
154  Set for 'ord' is not controlled
257  Solve statement not checked because of previous errors
408  Too many ),] or }
409  Unrecognizable item - skip to find a new statement
       looking for a ';' or a key word to get started again

**** 40 ERROR(S)   0 WARNING(S)
GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/15/12 14:56:09 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          finalbalancing.gms
     2      125 GDXIN          1     125  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          /data/gdx/sam3.gdx


COMPILATION TIME     =        0.093 SECONDS      4 Mb  WEX232-232 Aug 11, 2009


USER: Institute of Nuclear and New Energy Technology G101217:1031AV-WIN
      TsingHua Univerrsity                                       DC8455
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\dzhang\data\ChinaBalancedSAM\finalbalancing.gms
Output     C:\Users\dzhang\data\ChinaBalancedSAM\finalbalancing.lst

**** USER ERROR(S) ENCOUNTERED
