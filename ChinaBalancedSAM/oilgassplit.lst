GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/13/12 14:22:29 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


       
              Production activities   A (30)
              Commodities             C (30)
              Primary Factors         F (2)
              Households              H (1)
              Central Government      G1(1)
              Provincial Government   G2(1)
              Types of taxes          T (4)
              Rest of country         DX(1)
              Rest of world           X (1)
              Investment-savings      I (2)
       
      Here is a "MAP" of the SAM with the names of the submatrices which
      contain data.  All cells with no labels are empty:
       
       
       
                 A       C        F       H      G1      G2       T       DX    
        X      I1      I2
              ------------------------------------------------------------------
      ----------------------
      A       |       |   ac  |       |       |       |       |   sa  |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      C       |   ca  |       |       |   ch  |       |  g2d  |       |   der | 
        er  |  cs1  |  cs2  |
              ------------------------------------------------------------------
      ----------------------
      F       |   fa  |       |       |       |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      H       |       |       |   hf  |       |       |  hg2  |       |   dhr | 
        hr  |       |       |
              ------------------------------------------------------------------
      ----------------------
      G1      |       |       |       |       |       |  g1g2 |       |       | 
            |  cg1s |       |
              ------------------------------------------------------------------
      ----------------------
      G2      |       |       |       |       | g2g1  |       |   tr  |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      T       |   ta  |       |       |       |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      DX      |       |  drc  |       |  drh  |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      X       |       |   rc  |       |   rh  |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      I1      |       |       |   dp  |  psv1 | g1sv  |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
      I2      |       |   ic  |       |  psv2 |       |       |       |       | 
            |       |       |
              ------------------------------------------------------------------
      ----------------------
       
  49   
  50  *SAM table
  51  set     i   SAM rows and colums indices   /
  52          1*30    Industries,
  53          31*60   Commodities,
  54          61      Labor,
  55          62      Capital,
  56          63      Household,
  57          64      Central Government,
  58          65      Local Government,
  59          66      Production tax,
  60          67      Commodity tax,
  61          68      Factor tax,
  62          69      Income tax,
  63          70      Domestic trade,
  64          71      Foreign trade,
  65          72      Investment,
  66          73      Inventory/;
  67  alias (i,j,ii);
  68  *Energy balance table
  69  set ebti /
  70           1       DX,
  71           2       X,
  72           3       DRC,
  73           4       RC,
  74           5       AGR,
  75           6       COAL,
  76           7       OIL,
  77           8       MM,
  78           9       NM,
  79           10      FBT,
  80           11      TXT,
  81           12      CLO,
  82           13      LOG,
  83           14      PAP,
  84           15      ROIL,
  85           16      CHE,
  86           17      NMP,
  87           18      MSP,
  88           19      MP,
  89           20      GSM,
  90           21      TME,
  91           22      EME,
  92           23      CCE,
  93           24      IM,
  94           25      AC,
  95           26      WAS,
  96           27      ELEH,
  97           28      FG,
  98           29      WT,
  99           30      CON,
 100           31      TR,
 101           32      WRHR,
 102           33      OTH,
 103           34      NG,
 104           35      FU,
 105           36      INV,
 106           37      PROD
 107  /;
 108  set      e       energy product  /
 109           coal    Coal,
 110           fg      Fuel gas,
 111           oil     Crude oil,
 112           roil    Refined oil,
 113           ng      Natural gas,
 114           eleh    Electricity & heat,
 115           othe    Other energy/;
 116  set      r China provinces       /BEJ,TAJ,HEB,SHX,NMG,LIA,JIL,HLJ,SHH,JSU,
      ZHJ,ANH,FUJ,JXI,SHD,HEN,HUB,HUN,GUD,GXI,HAI,CHQ,SIC,GZH,YUN,SHA,GAN,NXA,QI
      H,XIN/;
 117  set      prange/
 118           LB,
 119           UB/;
 120  parameter sam2(r,i,j)           SAM v2.0
 121  parameter sam3(r,i,j)           SAM v3.0 ready for rebalancing
 122  parameter ebt(e,r,ebti)         EBT
 123  parameter pricerange(i,prange)  Price range of energy products
 124  parameter oilngratio(r)         Oil and gas ratio of (PROD+DRC+RC-X-DX)
 125  parameter poilng
GDXIN   C:\Users\dzhang\data\ChinaBalancedSAM\/data/gdx/aggregation.gdx
--- LOAD  sam2 = 5:sam2
 128  display sam2
GDXIN   C:\Users\dzhang\data\ChinaBalancedSAM\/data/gdx/egygdx/estimation/merged
        .gdx
--- LOAD  ebt = 23:ebt
 131  display ebt
GDXIN   C:\Users\dzhang\data\ChinaBalancedSAM\/data/gdx/egygdx/oilgasratio.gdx
--- LOAD  oilngratio = 8:oilngratio
 134  display oilngratio
GDXIN   C:\Users\dzhang\data\ChinaBalancedSAM\/data/gdx/egygdx/pricerange.gdx
--- LOAD  pricerange = 1:pricerange
 137  display pricerange
 138   
 139  parameter poilng;
 140  *price: oil/ng
 141  poilng=3;
 142  *oilgas
 143  parameter temp;
 144  *"Rough" split of crude oil and gas in sam3
 145  loop(r,
 146  loop(i,
 147  loop(j,
 148  sam3(r,i,j)=sam2(r,i,j);
 149  );
 150  );
 151  );
 152   
 153  * Production calibration
 154  loop(r,
 155  temp=sam3(r,"3","33");
 156  sam3(r,"3","33")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37")>0)=temp*poilng
      *ebt("OIL",r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 157  sam3(r,"30","60")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37")>0)=temp*ebt("
      NG",r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 158  );
 159  *sa
 160  loop(r,
 161  temp=sam3(r,"3","66");
 162  sam3(r,"3","66")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37")>0)=temp*poilng
      *ebt("OIL",r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 163  sam3(r,"30","66")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37")>0)=temp*ebt("
      NG",r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 164  );
 165  * DRC calibration
 166  loop(r,
 167  temp=sam3(r,"70","33");
 168  sam3(r,"70","33")$(poilng*ebt("OIL",r,"3")+ebt("NG",r,"3")>0)=temp*poilng*
      ebt("OIL",r,"3")/(poilng*ebt("OIL",r,"3")+ebt("NG",r,"3"));
 169  sam3(r,"70","60")$(poilng*ebt("OIL",r,"3")+ebt("NG",r,"3")>0)=temp*ebt("NG
      ",r,"3")/(poilng*ebt("OIL",r,"3")+ebt("NG",r,"3"));
 170  );
 171  * RC calibration
 172  loop(r,
 173  temp=sam3(r,"71","33");
 174  sam3(r,"71","33")$(poilng*ebt("OIL",r,"4")+ebt("NG",r,"4")>0)=temp*poilng*
      ebt("OIL",r,"4")/(poilng*ebt("OIL",r,"4")+ebt("NG",r,"4"));
 175  sam3(r,"71","60")$(poilng*ebt("OIL",r,"4")+ebt("NG",r,"4")>0)=temp*ebt("NG
      ",r,"4")/(poilng*ebt("OIL",r,"4")+ebt("NG",r,"4"));
 176  );
 177  * DX calibration
 178  loop(r,
 179  temp=sam3(r,"33","70");
 180  sam3(r,"33","70")$(poilng*ebt("OIL",r,"1")+ebt("NG",r,"1")>0)=temp*poilng*
      ebt("OIL",r,"1")/(poilng*ebt("OIL",r,"1")+ebt("NG",r,"1"));
 181  sam3(r,"60","70")$(poilng*ebt("OIL",r,"1")+ebt("NG",r,"1")>0)=temp*ebt("NG
      ",r,"1")/(poilng*ebt("OIL",r,"1")+ebt("NG",r,"1"));
 182  );
 183  * X calibration
 184  loop(r,
 185  temp=sam3(r,"33","71");
 186  sam3(r,"33","71")$(poilng*ebt("OIL",r,"2")+ebt("NG",r,"2")>0)=temp*poilng*
      ebt("OIL",r,"2")/(poilng*ebt("OIL",r,"2")+ebt("NG",r,"2"));
 187  sam3(r,"60","71")$(poilng*ebt("OIL",r,"2")+ebt("NG",r,"2")>0)=temp*ebt("NG
      ",r,"2")/(poilng*ebt("OIL",r,"2")+ebt("NG",r,"2"));
 188  );
 189  * INV calibration
 190  loop(r,
 191  if(sam3(r,"73","33")>0,
 192  temp=sam3(r,"73","33");
 193  sam3(r,"73","33")$(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36")>0)=temp*poiln
      g*ebt("OIL",r,"36")/(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36"));
 194  sam3(r,"73","60")$(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36")>0)=temp*ebt("
      NG",r,"36")/(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36"));
 195  else
 196  temp=sam3(r,"33","73");
 197  sam3(r,"33","73")$(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36")>0)=temp*poiln
      g*ebt("OIL",r,"36")/(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36"));
 198  *Oil in Guizhou
 199  sam3(r,"33","73")$(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36")=0)=0;
 200  sam3(r,"60","73")$(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36")>0)=temp*ebt("
      NG",r,"36")/(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36"));
 201  sam3(r,"60","73")$(poilng*ebt("OIL",r,"36")+ebt("NG",r,"36")>0)=0;
 202  );
 203  );
 204  * Capital formation calibration
 205  loop(r,
 206  temp=sam3(r,"33","72");
 207  sam3(r,"33","72")=temp*poilng*oilngratio(r);
 208  sam3(r,"60","72")=temp*(1-poilng*oilngratio(r));
 209  );
 210  * HH and GOV calibration
 211  loop(r,
 212  temp=sam3(r,"33","63");
 213  sam3(r,"33","63")$(poilng*ebt("OIL",r,"35")+ebt("NG",r,"35")>0)=temp*poiln
      g*ebt("OIL",r,"35")/(poilng*ebt("OIL",r,"35")+ebt("NG",r,"35"));
 214  sam3(r,"60","63")$(poilng*ebt("OIL",r,"35")+ebt("NG",r,"35")>0)=temp*ebt("
      NG",r,"35")/(poilng*ebt("OIL",r,"35")+ebt("NG",r,"35"));
 215  );
 216   
 217  * Other sectors calibration
 218  loop(r,
 219  loop(j$((ord(j)>=1) and (ord(j)<=30)),
 220  loop(ebti$(ord(ebti)=ord(j)+4),
 221  temp=sam3(r,"33",j);
 222  sam3(r,"33",j)$(poilng*ebt("OIL",r,ebti)+ebt("NG",r,ebti)>0)=temp*poilng*e
      bt("OIL",r,ebti)/(poilng*ebt("OIL",r,ebti)+ebt("NG",r,ebti));
 223  sam3(r,"60",j)$(poilng*ebt("OIL",r,ebti)+ebt("NG",r,ebti)>0)=temp*ebt("NG"
      ,r,ebti)/(poilng*ebt("OIL",r,ebti)+ebt("NG",r,ebti));
 224  );
 225  );
 226  );
 227  *COLUMN calibration
 228  *intinput
 229  loop(r,
 230  loop(i$(((ord(i)>=31) and (ord(i)<=60)) and (ord(i)<>33) and (ord(i)<>60))
      ,
 231  temp= sam3(r,i,"3");
 232  sam3(r,i,"30")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37")>0)=temp*poilng*e
      bt("OIL",r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 233  sam3(r,i,"3")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37")>0)=temp*ebt("NG",
      r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 234  );
 235  );
 236  *othinput
 237  loop(r,
 238  loop(i$((ord(i)>=61) and (ord(i)<=69)),
 239  temp=sam3(r,i,"3");
 240  sam3(r,i,"30")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"))=temp*poilng*ebt
      ("OIL",r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 241  sam3(r,i,"3")$(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"))=temp*poilng*ebt(
      "OIL",r,"37")/(poilng*ebt("OIL",r,"37")+ebt("NG",r,"37"));
 242  );
 243  );
 244   
 245   
 246   
 247  ****Filter
 248  *Calculation of sum of previous values
 249  parameter allsamsum1,allsamsum2,changeofoutput;
 250  allsamsum1=0;
 251  allsamsum2=0;
 252  loop(r,
 253  loop(i,
 254  loop(j,
 255  sam3(r,i,j)=sam3(r,i,j)/100000;
 256  allsamsum1=allsamsum1+sam3(r,i,j);
 257  );
 258  );
 259  );
 260  ****
 261  *Filter 1: Diminish sectors which take smaller than 0.5% of the total out
 262  parameter sumcolumn(r,i),sumrow(r,i);
 263  loop(r,
 264  loop(i,
 265  sumcolumn(r,i)=0;
 266  sumrow(r,i)=0;
 267  ););
 268  loop(r,
 269  loop(i,
 270  sumcolumn(r,i)=sum(j,sumcolumn(r,i)+sam3(r,j,i));
 271  );
 272  );
 273  loop(r,
 274  loop(i,
 275  sumrow(r,i)=sum(j,sumrow(r,i)+sam3(r,i,j));
 276  );
 277  );
 278  display sumcolumn,sumrow;
 279   
 280  parameter totoutput(r);
 281  parameter smallsector(r,i);
 282  loop(r,
 283  totoutput(r)=0;
 284  );
 285  loop(r,
 286  loop(i$((ord(i)>=31) and (ord(i)<=60)),
 287  totoutput(r)=totoutput(r)+sumcolumn(r,i);
 288  ););
 289  loop(r,
 290  loop(i$((ord(i)>=31) and (ord(i)<=60) and (sumcolumn(r,i)/totoutput(r)<0.0
      05) and not(((ord(i)=32) or (ord(i)=33) or (ord(i)=41) or (ord(i)=53) or (
      ord(i)=54) or (ord(i)=60)))),
 291  loop(ii$((ord(ii)=ord(i)) or (ord(ii)=ord(i)-30)),
 292  loop(j,
 293  sam3(r,ii,j)=0;
 294  sam3(r,j,ii)=0;
 295  );
 296  );
 297  smallsector(r,i)=1;
 298  ););
 299  loop(r,
 300  totoutput(r)=0;
 301  );
 302   
 303  *sam after filter1
 304  parameter tempsam(r,i,j);
 305  loop(r,
 306  loop(i,
 307  loop(j,
 308  tempsam(r,i,j)=sam3(r,i,j);
 309  );
 310  );
 311  );
 312  ****Filter 2: Diminishing all the input which is smaller than 1% of total 
      output
 313  loop(r,
 314  loop(i,
 315  sumcolumn(r,i)=0;
 316  sumrow(r,i)=0;
 317  ););
 318  loop(r,
 319  loop(i,
 320  sumcolumn(r,i)=sum(j,sumcolumn(r,i)+sam3(r,j,i));
 321  );
 322  );
 323  loop(r,
 324  loop(i,
 325  sumrow(r,i)=sum(j,sumrow(r,i)+sam3(r,i,j));
 326  );
 327  );
 328  loop(r,
 329  loop(i$((ord(i)>=31) and (ord(i)<=60)),
 330  totoutput(r)=totoutput(r)+sumcolumn(r,i);
 331  ););
 332  parameter incsparcity;
 333  incsparcity=0;
 334   
 335  loop(r,
 336  loop(i,
 337  *loop(j$((ord(j)>=1) and (ord(j)<=30) and not(((ord(i)=2) or (ord(i)=3) or
       (ord(i)=11) or (ord(i)=23) or (ord(i)=24) or (ord(i)=30)))),
 338  loop(j$((ord(j)>=1) and (ord(j)<=30)),
 339  if(((sam3(r,i,j)<0.01*sumcolumn(r,j)) AND (sam3(r,i,j)<>0)),
 340  sam3(r,i,j)=0;
 341  incsparcity=incsparcity+1;
 342  );
 343  allsamsum2=allsamsum2+sam3(r,i,j);
 344  );
 345  );
 346  );
 347  parameter totoutput2(r);
 348  loop(r,
 349  totoutput2(r)=0;
 350  );
 351  loop(r,
 352  loop(i$((ord(i)>=31) and (ord(i)<=60)),
 353  totoutput2(r)=totoutput2(r)+sum(j,sam3(r,i,j));
 354  ););
 355  parameter totchange(r);
 356  loop(r,
 357  loop(i$((ord(i)>=31) and (ord(i)<=60)),
 358  totchange(r)=(totoutput(r)-totoutput2(r))/totoutput(r);
 359  ););
 360   
 361  changeofoutput=(allsamsum1-allsamsum2)/allsamsum1*100/2;
 362  display changeofoutput
 363  display incsparcity;
 364   
 365  *Original energy related data
 366  parameter egyvalue(i,r,ebti);
 367  loop(r,
 368  loop(i$((ord(i)=2) or (ord(i)=3) or (ord(i)=11) or (ord(i)=23) or (ord(i)=
      24) or (ord(i)=30)),
 369  loop(j$(ord(j)=ord(i)+30),
 370  egyvalue(i,r,"1")=sam3(r,j,"70");
 371  egyvalue(i,r,"2")=sam3(r,j,"71");
 372  egyvalue(i,r,"3")=sam3(r,"70",j);
 373  egyvalue(i,r,"4")=sam3(r,"71",j);
 374  loop(ebti$((ord(ebti)>=5) and (ord(ebti)<=34)),
 375  loop(ii$(ord(ii)=ord(ebti)-4),
 376  egyvalue(i,r,ebti)=sam3(r,j,ii);
 377  );
 378  );
 379  egyvalue(i,r,"35")=sam3(r,j,"63")+sam3(r,j,"65");
 380  egyvalue(i,r,"36")=sam3(r,j,"73");
 381  egyvalue(i,r,"37")=sam3(r,i,j);
 382  );););
 383  display egyvalue;
 384   
 385  *chksam
 386  set     negval3(r,i,j)     Flag for negative elements;
 387  set     empty3(r,i,*)      Flag for empty rows and columns;
 388  parameter       chksam3(r,i,*)       Consistency check of social accounts;
 389  loop(r,
 390  negval3(r,i,j) = yes$(sam3(r,i,j) < 0);
 391   
 392  empty3(r,i,"row") = 1$(sum(j, sam3(r,i,j)) = 0);
 393  empty3(r,j,"col") = 1$(sum(i, sam3(r,i,j)) = 0);
 394   
 395  chksam3(r,i,"before") = sum(j, sam3(r,i,j)-sam3(r,j,i));
 396  chksam3(r,i,"scale") = sum(j, sam3(r,j,i));
 397  chksam3(r,i,"%dev")$sum(j, sam3(r,i,j)) = 100 * sum(j, sam3(r,i,j)-sam3(r,
      j,i)) / sum(j, sam3(r,i,j));
 398  );
 399   
 400  *Adjustment of energy data
 401  parameter ebt2(i,r,ebti)
 402  parameter isumebt(e,r)
 403  loop(i,
 404  loop(r,
 405  isumebt(i,r)=0;
****           $171
 406  ););
 407  loop(r,
 408  loop(ebti,
 409  loop(e,
 410  if(sameas(e,"coal"),
 411  ebt2("2",r,ebti)=ebt(e,r,ebti);
 412  );
 413  if(sameas(e,"fg"),
 414  ebt2("3",r,ebti)=ebt(e,r,ebti);
 415  );
 416  if(sameas(e,"oil"),
 417  ebt2("11",r,ebti)=ebt(e,r,ebti);
 418  );
 419  if(sameas(e,"roil"),
 420  ebt2("23",r,ebti)=ebt(e,r,ebti);
 421  );
 422  if(sameas(e,"ng"),
 423  ebt2("24",r,ebti)=ebt(e,r,ebti);
 424  );
 425  if(sameas(e,"eleh"),
 426  ebt2("30",r,ebti)=ebt(e,r,ebti);
 427  );
 428  );
 429  );
 430  );
 431  loop(i,
 432  loop(r,
 433  loop(ebti,
 434  isumebt(i,r)=isumebt(i,r)+ebt2(i,r,ebti);
****           $171         $171
 435  );););
 436  loop(i,
 437  loop(r,
 438  loop(ebti,
 439  if (ebt2(i,r,ebti)<0.01*isumebt(i,r),
****                                   $171
 440  ebt2(i,r,ebti)=0;
 441  );
 442  );
 443  ););
GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/13/12 14:22:29 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Error Messages


171  Domain violation for set

**** 4 ERROR(S)   0 WARNING(S)
GAMS Rev 232  WEX-WEI 23.2.1 x86_64/MS Windows          03/13/12 14:22:29 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          oilgassplit.gms
     2      126 GDXIN          1     126  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          /data/gdx/aggregation.gdx
     3      129 GDXIN          1     129  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          /data/gdx/egygdx/estimation/merged.gdx
     4      132 GDXIN          1     132  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          /data/gdx/egygdx/oilgasratio.gdx
     5      135 GDXIN          1     135  C:\Users\dzhang\data\ChinaBalancedSAM\
                                          /data/gdx/egygdx/pricerange.gdx


COMPILATION TIME     =        0.063 SECONDS      4 Mb  WEX232-232 Aug 11, 2009


USER: Institute of Nuclear and New Energy Technology G101217:1031AV-WIN
      TsingHua Univerrsity                                       DC8455
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\dzhang\data\ChinaBalancedSAM\oilgassplit.gms
Output     C:\Users\dzhang\data\ChinaBalancedSAM\oilgassplit.lst

**** USER ERROR(S) ENCOUNTERED
